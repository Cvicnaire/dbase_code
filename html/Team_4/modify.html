<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Protection Page</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .logo-container {
            text-align: left; 
            display: inline-block; 
            width: 100%; 
        }
        .logo {
            display: inline-block;
        }
        #passwordForm, #newPasswordForm {
            margin-top: 50px;
            text-align: center;
        }
        input[type="password"], input[type="submit"], button {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
            width: 100px; 
            height: 40px; 
            display: inline-block;
            vertical-align: middle;
            text-align: center;
        }
        #password {
            width: 200px; 
            height: 20px; 
            font-size: 16px; 
        }
        #protectedContent {
            display: none;
            text-align: center;
        }
        /* Style the links inside the dropdown menu */
.dropdown-menu a {
   color: black;
   padding: 12px 16px;
   text-decoration: none;
   display: block;
}

/* Change color of dropdown links on hover */
.dropdown-menu a:hover {
   background-color: #f1f1f1;
}

/* Show the dropdown menu when hovering over its parent */
.nav-menu li:hover .dropdown-menu {
   display: block;
}

    </style>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->

</head>
<div id="header-placeholder"></div>
<body>
    <div id="passwordForm">
        <form id="loginForm">
            <label for="password">Enter Password:</label><br>
            <input type="password" id="password" name="password" required><br>
            <input type="submit" value="Submit" id="submitBtn">
        </form>
    </div>

    <div id="protectedContent">
        <h2>Modify Existing Entries</h2>
        <!DOCTYPE html>
        <html lang="en">
        <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Update Sort Data</title>
        </head>
        <body>

        <h2>Update Data</h2>

        <select id="formSelector" onchange="showForm()">
          <option value="Select Table" selected>Select Table</option>
          <option value="line">Mosquito Lines</option>
          <option value="member">Lab Members</option>
          <option value="sort">Sort</option>
          <option value="pass">Passage</option>
          <option value="clutch">Clutch</option>
        </select>
        
        <form id="line" class="tableFields" style="display: none;">
            <label for="l_id">Line ID: <span class="required">*</span></label>
            <input type="text" id="l_id" name="l_id" placeholder="l_id"><br>
            <label for="yl_id">Younger Lab ID: (Read only) <span class="required">*</span></label>
            <input type="text" id="yl_id" name="yl_id" readonly required placeholder="YL ID"><br>
            <label for="short_name">Short Name: <span class="required">*</span></label>
            <input type="text" id="short_name" name="short_name" required placeholder="Short Name"><br>
            <label for="full_genotype">Full Genotype: <span class="required">*</span></label>
            <textarea type="text" id="full_genotype" name="full_genotype" required placeholder="Full Genotype"></textarea><br>
            <label for="background">Background:</label>
            <input type="text" id="background" name="background" placeholder="ORL or LVP"><br>
            <label for="phenotype">Phenotype:</label>
            <textarea type="text" id="phenotype" name="phenotype" placeholder="Ex. bright blue eyes or not fluorescent"></textarea><br>
            <label for="phenotype_notes">Phenotype Notes:</label>
            <input type="text" id="phenotype_notes" name="phenotype_notes" placeholder="Phenotype Notes"><br>
            <label for="maintenance">Maintenance: <span class="required">*</span></label>
            <input type="text" id="maintenance" name="maintenance" required placeholder="Active or Retired"><br>
            <br>
            <label for="published">PubMed ID:</label>
            <input type="text" id="published" name="published" placeholder="PubMed ID or Unpublished"><br>
            <label for="authors">Authors:</label>
            <input type="text" id="authors" name="authors" placeholder="Ex. DeObaldia et al., 2022"><br>
            <label for="creators">Line Creators:</label>
            <input type="text" id="creators" name="creators" placeholder="Ex. Meg Younger, Ben Matthews, Zachary Gilbert"><br>
            <label for="genotype_notes">Genotype Notes:</label>
            <textarea type="text" id="genotype_notes" name="genotype_notes" placeholder="Genotype Notes"></textarea><br>
            <label for="dna_avail">DNA Available:</label>
            <input type="text" id="dna_avail" name="dna_avail" placeholder=""><br>
            <label for="notes">Notes:</label>
            <textarea type="text" id="notes" name="notes" placeholder=""></textarea><br>
            <button type="button" onclick="submitForm()">Submit</button>
        </form>

        <form id="member" class="tableFields" style="display: none;">
            <label for="m_id">Member ID:</label>
            <input type="text" id="m_id" name="m_id" placeholder="m_id"><br>
            <label for="f_name">First Name:</label>
            <input type="text" id="f_name" name="f_name" placeholder="First Name"><br>
            <label for="l_name">Last Name:</label>
            <input type="text" id="l_name" name="l_name" placeholder="Last Name"><br>
            <label for="lab_role">Lab Role:</label>
            <input type="text" id="lab_role" name="lab_role" placeholder="Ex. Undergraduate Researcher"><br>
            <label for="active">Active:</label>
            <input type="text" id="active" name="active" placeholder="Active or Inactive"><br>
            <button type="button" onclick="submitForm()">Submit</button>
        </form>

        <form id="sort" class="tableFields" style="display: none;">
            <label for="sort_id">Sort ID:</label>
            <input type="text" id="sort_id" name="sort_id"><br>
            <label for="sort_m_id">Member ID:</label>
            <input type="text" id="sort_m_id" name="m_id" placeholder="m_id"><br>
            <label for="sort_l_id">Line ID:</label>
            <input type="text" id="sort_l_id" name="l_id" placeholder="l_id"><br>
            <label for="hatch_date">Hatch Date:</label>
            <input type="text" id="sort_hatch" name="hatch_date"><br>
            <label for="sort_date">Sort Date:</label>
            <input type="text" id="sort_date" name="sort_date"><br>
            <label for="line_name">Line Name:</label>
            <input type="text" id="line_name" name="line_name"><br>
            <label for="marker_color">Marker Color:</label>
            <input type="text" id="marker_color" name="marker_color"><br>
            <label for="marker_location">Marker Location:</label>
            <input type="text" id="marker_location" name="marker_location"><br>
            <label for="fl_ratio">FL Ratio:</label>
            <input type="text" id="fl_ratio" name="fl_ratio"><br>
            <label for="fl_total">FL Total:</label>
            <input type="text" id="fl_total" name="fl_total"><br>
            <label for="notes">Notes:</label>
            <input type="text" id="notes" name="notes"><br>
            <button type="button" onclick="submitForm()">Submit</button>
        </form>
        
        <form id="pass" class="tableFields" style="display: none;">
            <label for="pass_id">Passage ID:</label>
            <input type="text" id="pass_id" name="pass_id"><br>
            <label for="pass_m_id">Member ID:</label>
            <input type="text" id="pass_m_id" name="m_id" placeholder="m_id"><br>
            <label for="pass_l_id">Line ID:</label>
            <input type="text" id="pass_l_id" name="l_id" placeholder="l_id"><br>
            <label for="bc">BC:</label>
            <input type="text" id="bc" name="bc" placeholder="BC"><br>
            <label for="ib">IB:</label>
            <input type="text" id="ib" name="ib" placeholder="IB"><br>
            <label for="hatch_date">Hatch Date:</label>
            <input type="text" id="passage_hatch" name="hatch_date" placeholder="Hatch Date"><br>
            <label for="mating_line">Mating Line:</label>
            <input type="text" id="mating_line" name="mating_line" placeholder="Mating Line"><br>
            <label for="passage_date">Passage Date:</label>
            <input type="text" id="passage_date" name="passage_date" placeholder="Passage Date"><br>
            <label for="passage_date">Next Passage Date:</label>
            <input type="text" id="next_passage" name="next_passage" placeholder="Next Passage Date"><br>
            <button type="button" onclick="submitForm()">Submit</button>
        </form>
      
        <form id="clutch" class="tableFields" style="display: none;">
            <label for="clutch_id">Clutch ID:</label>
            <input type="text" id="clutch_id" name="clutch_id" placeholder="Clutch ID"><br>
            <label for="clutch_m_id">Member ID:</label>
            <input type="text" id="clutch_m_id" name="m_id" placeholder="m_id"><br>
            <label for="clutch_l_id">Lab ID:</label>
            <input type="text" id="clutch_l_id" name="l_id" placeholder="l_id"><br>
            <label for="hatch_date">Hatch Date:</label>
            <input type="text" id="clutch_hatch" name="hatch_date" placeholder="Hatch Date"><br>
            <label for="collection_date">Collection Date:</label>
            <input type="text" id="collection_date" name="collection_date" placeholder="Collection Date"><br>
            <label for="clutch_number">Clutch Number:</label>
            <input type="text" id="clutch_number" name="clutch_number" placeholder="Clutch Number"><br>
            <label for="egg_papers">Egg Papers:</label>
            <input type="text" id="egg_papers" name="egg_papers" placeholder="Egg Papers"><br>
            <button type="button" onclick="submitForm()">Submit</button>
        </form>
    

        <div id="successMessage" style="display: none; color: green; margin-top: 10px;">Update successful!</div>

        <script>
        
// Ensure the default option is selected on page load
document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("formSelector").value = "Select Table";
        });

function showForm() {
    var selectedForm = document.getElementById("formSelector").value;
    var forms = document.getElementsByClassName("tableFields");
    for (var i = 0; i < forms.length; i++) {
        forms[i].style.display = (forms[i].id === selectedForm) ? "block" : "none";
    }
}

// Function to populate data based on ID field of the selected form
function populateFormData(formType, id) {
    var form = new FormData();
    form.append("selector", formType);
    form.append("id", id);
    fetch('/cgi-bin/students_24/Team_4/get.py', {
        method: 'POST',
        body: form},)
    .then(response => response.json())
    .then(data => {
        console.log("Received data:", data);
        if (data.error) {
            alert("Failed to fetch data: " + data.error);
        } else {
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    var element = document.getElementById(key);
                    console.log("Processing key:", key);
                    if (element) {
                        console.log("Element found:", element);
                        element.value = data[key] || "";
                        console.log("Set value to:", element.value);
                    } else {
                        console.error("Element not found for key:", key);
                    }
                }
            }
        }
    })
    .catch(error => {
        console.error("Fetch error:", error);
        alert("Failed to fetch data: " + error);
    });
}

function resetForm(formId) {
            var form = document.getElementById(formId);
            if (form) {
                form.reset();  // Reset the form inputs
            }
        }

// Event listener for the input changes on the selected form
document.getElementById("formSelector").addEventListener("change", function() {
    var selectedForm = document.getElementById("formSelector").value;

    // Reset form upon switching to it
    resetForm(selectedForm);

    var idField;
    switch (selectedForm) {
        case "line":
            idField = "l_id";
            break;
        case "member":
            idField = "m_id";
            break;
        case "sort":
            idField = "sort_id";
            break;
        case "pass":  // Fixed to match the form ID
            idField = "pass_id";
            break;
        case "clutch":
            idField = "clutch_id";
            break;
        default:
            idField = null;
    }
    if (idField) {
        document.getElementById(idField).addEventListener("input", function() {
            var id = document.getElementById(idField).value;
            populateFormData(selectedForm, id);
        });
    }
});


// Function to submit form based on the selected form
function submitForm() {
    var selectedForm = document.getElementById("formSelector").value;
    var formData = new FormData(document.getElementById(selectedForm));
    formData.append("selector", selectedForm);
    console.log(formData);
    fetch('/cgi-bin/students_24/Team_4/update.py', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        if (data.success) {
            document.getElementById("successMessage").style.display = "block";
            document.getElementById(selectedForm).reset(); // Clear form fields after successful submission
        } else {
            alert("Failed to update database: " + data.error);
        }
    })
    .catch(error => {
        console.error("Fetch error:", error);
        alert("Failed to update database: " + error);
    });
}
   
        $(document).ready(function() {
            // Event listener for the login form submission
            $('#loginForm').submit(function(e) {
                e.preventDefault(); // Prevent the default form submission
                authenticate(); // Call the authenticate function
            });
        });

        function authenticate() {
            var password = $('#password').val();
            // Check if the password is correct

            // $.ajax({
            //         url: 'compareString.php',
            //         type: 'POST',
            //         data: { userInput: password },
            //         dataType: 'json',
            //         success: function(response) {
            //             if (response.match) {
            //                 // Show the protected content
            //                 $('#protectedContent').show();
            //                 // Hide the password form
            //                 $('#passwordForm').hide();
            //             } else {
            //                 alert('Incorrect password! Please try again.');
            //             }
            //         },
            //         error: function() {
            //             $('#result').text('Error comparing the string.');
            //         }
            //     });

            if (password === 'pass') { // Replace 'pass' with actual password
                // Show the protected content
                $('#protectedContent').show();
                // Hide the password form
                $('#passwordForm').hide();
            } else {
                // Incorrect password, show an error message
                alert('Incorrect password! Please try again.');
            }
        }

        fetch('header.html')
      .then(response => response.text())
      .then(html => {
          document.getElementById('header-placeholder').innerHTML = html;
      })
      .catch(error => {
          console.error('Error fetching header:', error);
      });
        </script>
</body>
</html>

